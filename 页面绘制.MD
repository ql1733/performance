## 页面绘制

### 第一次渲染时发生了什么

1. 生成dom树.
    当浏览器开始接收到HTML 的数据流时，主线程就开始解析HTML 并转换成DOM树，解析过程是流式进行的。

2. 加载资源
    在解析html 时 浏览器开始请求页面中能够解析出的资源，图片，css,js

3. 阻塞解析的js
    在解析html时遇到内联的js 或没有defer/async 的script 标签，就会阻塞html 的解析，并且先下载并执行js。

4. 生成cssom 
    浏览器接下来会解析样式并生成cssom，这个过程同样在主线程完成，浏览器在解析css后会根据选择器与规则生成对应的cssom 。

5. 生成渲染树
    浏览器从dom 树开始遍历节点，并在cssom 中找到每个节点对应的样式规则，将两者合并成一颗树用于渲染。

6. 计算布局
    有了包含样式和内容的渲染树，浏览器仍然无法开始绘制，浏览器并不知道应该把每个元素放在什么位置及大小。为了计算具体位置，主线程开始遍历渲染树，把相对的位置和布局换成屏幕上的绝对像素,生成布局树

7. 分成
    有了完整的渲染树和布局树，以及页面内容，样式布局，依然不知道应该安照什么顺序绘制元素。z-index,3d变换场景可能导致元素覆盖。因此需要针对这些元素生成对应的图层树（Layer Tree）。

8. 绘制
    有了各个图层后就可以开始绘制了，现在要把这些几何信息输出成像素点，这个过程叫光栅化，并将各个层进行合并，这个过程叫合成。


### 重排

当dom 本身或位置发生变化时，就需要从布局开始重新走完所有流程，并触发后面的绘制工作。

导致重排的操作
1. 修改dom或样式
2. 运动dom位置
3. 调整窗口大小，滚动。

### 重绘

改变一些元素的样式信息，如颜色。重排必然导致重绘，重排的性能损耗总是高于重绘的。

尽快返回html,减少资源阻塞。